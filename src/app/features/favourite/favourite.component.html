<!-- features/favourite/favourite.component.html -->
<div class="favourite-container">
  <main class="books-main">
    <header class="books-header">
      <div class="header-content">
        <div class="header-text">
          <h1 class="header-title">ุงูููุถูุฉ</h1>
          <p class="header-subtitle">ูุชุจู ุงูููุถูุฉ ({{ favouriteItems.length }})</p>
        </div>
      </div>
    </header>

    <div class="books-list-section">
      <div class="section-header">
        <h2 class="section-title-main">ูุงุฆูุฉ ุงูููุถูุฉ</h2>
        <div class="books-count">
          <span class="count-number">{{ favouriteItems.length }}</span>
          <span class="count-text">ูุชุงุจ</span>
        </div>
      </div>

      <div class="favourite-grid">
        <div *ngFor="let book of favouriteItems; trackBy: trackById" class="book-card">
          <!-- โ EXACT SAME IMAGE SECTION -->
          <div class="book-image-container">
            <div class="image-wrapper">
              <img
                [src]="getImageUrl(book.imgs[0])"
                [alt]="book.name"
                class="book-image"
                (error)="handleImageError(book._id)"
                loading="lazy" />
              <div class="stock-badge" [class.out-of-stock]="book.stockStatus === 'outOfStock'">
                {{ book.stockStatus === 'inStock' ? 'ูุชููุฑ' : 'ุบูุฑ ูุชููุฑ' }}
              </div>
              <div class="offer-badge" *ngIf="book.offer > 0">
                ุฎุตู {{ book.offer }}%
              </div>
            </div>
            <div class="image-thumbnails-small" *ngIf="book.imgs.length > 1">
              <div
                *ngFor="let img of book.imgs.slice(0, 4); let i = index"
                class="thumbnail-small"
                (click)="openImageModal(img, book)">
                <img [src]="getImageUrl(img)" [alt]="book.name" />
              </div>
              <div class="more-images" *ngIf="book.imgs.length > 4" (click)="openImageModal(book.imgs[0], book)">
                +{{ book.imgs.length - 4 }}
              </div>
            </div>
          </div>

          <!-- โ EXACT SAME CONTENT SECTION -->
          <div class="book-content">
            <h3 class="book-name">{{ book.name }}</h3>
            <p class="book-title">{{ book.title }}</p>
            <div class="book-category">{{ getCategoryEmoji(book.category) }} {{ book.category }}</div>

            <!-- โ BOOK DETAILS (Code + Quantity) -->
            <div class="book-details">
              <div class="detail-item">
                <span class="detail-label">ุงูููุฏ:</span>
                <span class="detail-value">{{ book.code || 'ุบูุฑ ูุญุฏุฏ' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">ุงููููุฉ:</span>
                <span class="detail-value">{{ book.quantity }}</span>
              </div>
            </div>

            <!-- โ EXACT SAME PRICE SECTION -->
            <div class="book-price">
              <div class="price-main">
                <span class="current-price">{{ calculateBookFinalPrice(book) | number:'1.2-2' }}</span>
                <span class="currency">ุฌููู</span>
              </div>
              <div class="price-original" *ngIf="book.offer > 0">
                <span class="original-amount">{{ book.price | number:'1.2-2' }}</span>
              </div>
            </div>

            <!-- โ CART BUTTON ONLY (Remove Favorite is separate) -->
            <div class="book-actions">
              <button
                class="action-btn cart"
                (click)="toggleCart(book)"
                [class.active]="isInCart(book)">
                {{ isInCart(book) ? 'ุฅุฒุงูุฉ ูู ุงูุณูุฉ' : 'ุฃุถู ุฅูู ุงูุณูุฉ' }}
              </button>
            </div>

            <!-- โ REMOVE FAVORITE BUTTON (Above description) -->
            <button
              class="remove-fav-btn"
              (click)="removeFromFavorites(book)">
              <span>๐๏ธ ุฅุฒุงูุฉ ูู ุงูููุถูุฉ</span>
            </button>

            <!-- โ DESCRIPTION -->
            <div class="book-description" *ngIf="book.description">
              {{ book.description | slice:0:80 }}{{ book.description.length > 80 ? '...' : '' }}
            </div>
          </div>
        </div>
      </div>

      <!-- โ EMPTY STATE -->
      <div class="empty-state" *ngIf="favouriteItems.length === 0">
        <div class="empty-icon">โค๏ธ</div>
        <h3>ูุงุฆูุฉ ุงูููุถูุฉ ูุงุฑุบุฉ</h3>
        <p>ูู ุชูู ุจุฅุถุงูุฉ ุฃู ูุชุจ ุจุนุฏ. ุชุตูุญ ูุฌููุนุชูุง ูุฃุถู ูุชุจู ุงูููุถูุฉ!</p>
        <button class="explore-btn" (click)="exploreBooks()">ุงุณุชูุดุงู ุงูุขู</button>
      </div>
    </div>

    <!-- โ CLEAR ALL MODAL -->
    <div *ngIf="showClearModal" class="modal-overlay" (click)="closeClearModal()">
      <div class="modal" (click)="$event.stopPropagation()">
        <h3>ุชุฃููุฏ ุงููุณุญ</h3>
        <p>ูู ุชุฑูุฏ ูุณุญ ุฌููุน ุงููุชุจ ูู ุงูููุถูุฉุ</p>
        <div class="modal-actions">
          <button class="btn-cancel" (click)="closeClearModal()">ุฅูุบุงุก</button>
          <button class="btn-confirm" (click)="clearFavourites()">ุชุฃููุฏ</button>
        </div>
      </div>
    </div>

    <!-- โ IMAGE MODAL -->
    <div class="modal" *ngIf="imageModalUrls && imageModalUrls.length > 0" (click)="imageModalUrls = null">
      <div class="modal-content large" (click)="$event.stopPropagation()">
        <button class="close-modal" (click)="imageModalUrls = null">โ</button>
        <div class="carousel">
          <img [src]="getImageUrl(imageModalUrls[currentImageIndex])" alt="Full-size Image" class="modal-image" />
          <button class="carousel-btn prev" *ngIf="imageModalUrls.length > 1" (click)="prevImage()">โฎ</button>
          <button class="carousel-btn next" *ngIf="imageModalUrls.length > 1" (click)="nextImage()">โฏ</button>
          <div class="carousel-indicators" *ngIf="imageModalUrls.length > 1">
            <span
              *ngFor="let img of imageModalUrls; let i = index"
              [class.active]="i === currentImageIndex"
              (click)="currentImageIndex = i"></span>
          </div>
          <div class="image-counter">{{ currentImageIndex + 1 }} / {{ imageModalUrls.length }}</div>
        </div>
      </div>
    </div>
  </main>
</div>
